# Kotitehtävä 5: CSI Kerava

## x) Lue ja tiivistä
Artikkelissa [Apache User Homepages Automatically – Salt Package-File-Service Example](https://terokarvinen.com/2018/04/03/apache-user-homepages-automatically-salt-package-file-service-example/) Karvinen kertoo, miten Apachen käyttäjäkotisivut voidaan luoda automaattisesti käyttäen Salttia.

### i. Missä konfiguraatiokansiot?
- Lataa manuaalisesti komponentit, ennen kuin automatisoit ja katso mitä tiedostoja muokattiin. Voit ajaa komennon `sudo a2enmod userdir` ja luo timeline muokkauksista hakemistoon `/etc/apache2`. Komennoilla `find` ja `printf` voit näyttää muokkauksien tapahtuma-ajan.
- Komennoilla `ls -l`, `cat`, `less` voit etsiä lisää tietoa.

### ii. Quick Way with a Command
- Kun luodaan komento statessa, komennosta pitää tehdä idempotentti. `init.sls`:llä voidaan automatisoida tehtäviä. `creates` varmistaa, että komento ajetaan vain jos tiedostoa ei ole olemassa.

### iii. Better Way with Files
- Korvataan komentosuoritukset file managementilla, tehdäksemme siitä luotettavamman prosessin. Näin sitä on helpompaa ennakoida ja voidaan varmistaa toistettavuus.

### iv. Contents of the Template
- `cat /srv/salt/apache/default-index.html`: tänne menee sisältö.

### v. Applying the Manifest
- `sudo salt '*' state.apply apache`: komennolla voidaan asettaa statet.

### vi. Testing it
- `whoami`
- `cd /home/username/`
- `mkdir public_html`
- `echo "User's homepage" |tee public_html/index.html`

## a) CSI Kerava
> Näytä 'find' avulla viimeisimmäksi muokatut tiedostot /etc/-hakemistosta ja kotihakemistostasi.

![image](https://github.com/16cats/Infra-as-Code-course/assets/97065659/d3129263-e460-4999-847d-9ef2b48348e3)

![image](https://github.com/16cats/Infra-as-Code-course/assets/97065659/a58b5b8b-0841-44bc-b5de-7ff9aaf98fee)

`find`: komento, joka etsii tiedostoja siinä hakemistohierkarkiassa, missä ollaan
`%T+` on modifikaation aikaleima
`%p` on tiedoston nimi ja polku
`\n` on uusi rivi.

## b) Gui2fs
> Muokkaa asetuksia jostain graafisen käyttöliittymän (GUI) ohjelmasta käyttäen ohjelman valikoita ja dialogeja. Etsi tämä asetus tiedostojärjestelmästä.

![image](https://github.com/16cats/Infra-as-Code-course/assets/97065659/d909ec3e-b014-4cf2-8337-054c0bcca236)

`find -printf "%T+ %p\n"|sort`:
![image](https://github.com/16cats/Infra-as-Code-course/assets/97065659/48f8d8b0-3e07-4dd2-8a1c-93c20279513a)

Jokainen rivi alkaa aikaleimalla, joka näyttää, milloin tiedostoa on viimeksi muokattu. Sen jälkeen se näyttää missä hakemistossa ollaan; tässä ollaan kotihakemistossa `./code`. 
Tästä nähdään, että Mousepad-muistion tiedostoille on tehty jotain konfiguraatiota, tai ainakin siellä on käyty. Tarkemmin se ei näytä, että mitä on tehty.
```
2023-11-26+22:56:08.4720000000 ./code/.local/share/Mousepad
2023-11-26+22:56:08.7320000000 ./code/.local/share/recently-used.xbel
2023-11-26+22:56:08.7440000000 ./code/.local/share
```

![image](https://github.com/16cats/Infra-as-Code-course/assets/97065659/8e8b24ce-1889-4b03-adfa-384ac9af19fe)

## c) Komennus
> Tee Salt-tila, joka asentaa järjestelmään uuden komennon.
Noniin. Viime tunnilla käytiin läpi skriptaus ja tehtiin se myös manuaalisesti. Muistan myös edelliseltä [Linux-kurssilta](https://github.com/16cats/Linux/blob/main/h7.md) miten osa siitä tehtiin. Tehdään se manuaalisesti vielä kerran vagrantissa masterilla, ennen kuin automatisoidaan se.

![image](https://github.com/16cats/Infra-as-Code-course/assets/97065659/5c43b4be-413e-4da3-a6a0-ffa4522e123b)

